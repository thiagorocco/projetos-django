{% extends 'financeiro/base.html' %}
{% load static %}
{% block titulo %}Relatório de lançamentos{% endblock %}
{% block content %}
<br><br>
    <h2>Relatório de Lançamentos</h2>
    <form action="{% url 'rel_lancamentos' %}" class="form-rel-filter">
        <h3>Filtros de Pesquisa</h3>
        Data Inicial: <input type="date" name="data-inicio" value="{{ dtini }}" required >
        Data Final: <input type="date" name="data-fim" value="{{ dtfim }}" required>
        Categoria: <select name="categoria">
                                <option value="-1">*** TODAS ***</option>
                        {% for categoria in categorias %}
                            {% if categoria.id == cat %}
                                <option value="{{ categoria.id }}" selected>{{ categoria.nome }}</option>
                            {% else %}    
                                <option value="{{ categoria.id }}">{{ categoria.nome }}</option>
                            {% endif %}
                        {% endfor %}    
                   </select>
        Operação: <select name="operacao">
                        <option value="t">*** TODAS ***</option>
                        <option value="s" {% if op == 's'%}selected{% endif %}>Saída</option>
                        <option value="e" {% if op == 'e'%}selected{% endif %}>Entrada</option>
                  </select>
        Origem: <select name="origem">
                            <option value="-1">*** TODAS ***</option>
                    {% for origem in origens %}
                        {% if origem.id == orig %}
                            <option value="{{ origem.id}}" selected>{{ origem.nome }}</option>
                        {% else %}
                            <option value="{{ origem.id}}">{{ origem.nome }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
        <input type="submit" value="Filtrar">
    </form>
    <br>
    <table>
        <thead>
            <tr>
            <th class="linha"></th>
            <th>Data</th>
            <th>Categoria</th>
            <th>Descrição</th>
            <th>Valor</th>
            <th>Operação</th>
            <th>Origem</th>
            <th colspan="2">AÇÃO</th>
        </tr>
    </thead>
    {% if imprimir %}
        {% if sem_resultados  %}
            <tr class="msg-no-result">
                <td class="linha"></td>
                <td colspan="7">Não há registros para o filtro informado</td>
            </tr>
        {% else %}    
            {% for lcto in lctos %}
            <tr>
                <td class="linha">{{ forloop.counter }}</td>
                <td>{{ lcto.data|date:"d/m/Y" }}</td>
                <td>{{ lcto.nome_categoria }}</td>
                <td>{{ lcto.descricao }}</td>
                <td>R$ {{ lcto.valor }}</td>
                <td>{{ lcto.tipo_operacao }}</td>
                <td>{{ lcto.nome_origem}}</td>
                <td><a href="/update_get_lcto/{{lcto.id}}"><i class="fa-solid fa-pen" title="EDITAR REGISTRO"></i></a> | <a href="/delete_lcto/{{lcto.id}}"><i class="fa-solid fa-trash" title="EXCLUIR REGISTRO"></i></a></td>
            </tr>
            {% endfor %}
        {% endif %}
    {% else %}
        <tr class="msg-init-filter">
            <td class="linha"></td>
            <td colspan="7">Informe os filtros acima para gerar o relatório.</td>
        </tr>
    {% endif %}
</table>
    {% if messages %}
    {% for message in messages %}
        <p 
            {% if message.tags %} 
                class="msg-{{ message.tags }}" 
            {% endif %}>
            {{ message }}
        </p>
    {% endfor %}
    {% endif %}
{% endblock %}
